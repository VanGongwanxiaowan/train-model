# ç¯å¢ƒç‰ˆæœ¬æ£€æŸ¥æŠ¥å‘Š

## ğŸ” æ£€æŸ¥ç»“æœ

### âŒ ä¸¥é‡é—®é¢˜ï¼šå…³é”®åŒ…ç‰ˆæœ¬ä¸åŒ¹é…

| åŒ…å | å½“å‰ç‰ˆæœ¬ | ç›®æ ‡ç‰ˆæœ¬ | çŠ¶æ€ | å½±å“ |
|------|---------|---------|------|------|
| **torch** | 2.4.1+cu121 | 1.11.0+cu113 | âŒ | **ä¸¥é‡** - æ¨¡å‹å…¼å®¹æ€§é—®é¢˜ |
| **torchaudio** | 2.4.1 | 0.11.0+cu113 | âŒ | **ä¸¥é‡** - éŸ³é¢‘å¤„ç†å¤±è´¥ |
| **torchvision** | 0.19.1 | 0.12.0+cu113 | âŒ | **ä¸¥é‡** - å›¾åƒå¤„ç†å¤±è´¥ |
| **onnxruntime-gpu** | 1.19.2 | 1.16.0 | âŒ | **ä¸­ç­‰** - GPUæ¨ç†å¤±è´¥ |

### âœ… åŒ¹é…çš„åŒ…ï¼ˆ16ä¸ªï¼‰

ä»¥ä¸‹åŒ…ç‰ˆæœ¬æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹ï¼š
- gradio: 4.44.1 âœ“
- fastapi: 0.115.11 âœ“
- uvicorn: 0.33.0 âœ“
- numpy: 1.24.4 âœ“
- opencv-python: 4.11.0.86 âœ“
- librosa: 0.11.0 âœ“
- scipy: 1.10.1 âœ“
- pandas: 2.0.3 âœ“
- pillow: 10.4.0 âœ“
- pydantic: 2.10.6 âœ“
- starlette: 0.44.0 âœ“
- pydantic_core: 2.27.2 âœ“
- numba: 0.58.1 âœ“
- soundfile: 0.13.1 âœ“
- scikit-learn: 1.3.2 âœ“
- scikit-image: 0.21.0 âœ“

## ğŸ¯ é—®é¢˜æ ¹æºåˆ†æ

### 1. PyTorch ç‰ˆæœ¬é—®é¢˜

**å½“å‰çŠ¶æ€**:
- PyTorch: 2.4.1+cu121 (CUDA 12.1)
- CUDA å¯ç”¨: True
- ä½†ç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´æ¨¡å‹æ— æ³•åŠ è½½

**éœ€è¦ç‰ˆæœ¬**:
- PyTorch: 1.11.0+cu113 (CUDA 11.3)
- è¿™æ˜¯ä¸€ä¸ª 2022 å¹´å‘å¸ƒçš„æ—§ç‰ˆæœ¬

**å½±å“**:
- SDK ä»£ç å¯èƒ½ä½¿ç”¨äº† PyTorch 1.11 ç‰¹å®šçš„ API
- æ¨¡å‹æƒé‡æ ¼å¼å¯èƒ½ä¸å…¼å®¹
- GPU é©±åŠ¨/CUDA ç‰ˆæœ¬ä¸åŒ¹é…

### 2. ONNX Runtime GPU ç‰ˆæœ¬é—®é¢˜

**å½“å‰çŠ¶æ€**:
- ONNX Runtime GPU: 1.19.2
- éœ€è¦ CUDA 12.x å’Œ cuDNN 9.x

**éœ€è¦ç‰ˆæœ¬**:
- ONNX Runtime GPU: 1.16.0
- éœ€è¦ CUDA 11.x å’Œ cuDNN 8.x

**å½±å“**:
- æˆ‘ä»¬å·²ç»å®‰è£…äº† cudatoolkit 11.8.0 å’Œ cuDNN 8.9.2.26
- ä½† ONNX Runtime ç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´æ— æ³•ä½¿ç”¨ GPU

### 3. é˜Ÿåˆ—é˜»å¡é—®é¢˜

**æ ¹æœ¬åŸå› **:
- PyTorch ç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´æ¨¡å‹åŠ è½½å¤±è´¥
- GPU æ— æ³•æ­£ç¡®åˆå§‹åŒ–
- è§†é¢‘å¸§ç”Ÿæˆè¿›ç¨‹å¼‚å¸¸
- é˜Ÿåˆ—é˜»å¡ï¼Œæ— æ³•ç»§ç»­å¤„ç†

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: é™çº§ PyTorchï¼ˆæ¨èä½†å¯èƒ½å›°éš¾ï¼‰

**æŒ‘æˆ˜**:
- PyTorch 1.11.0 æ˜¯ 2022 å¹´çš„ç‰ˆæœ¬ï¼Œpip å¯èƒ½ä¸å†æä¾›
- éœ€è¦ CUDA 11.3ï¼Œä½†ç³»ç»Ÿå¯èƒ½æœ‰ CUDA 12.x
- å¯èƒ½éœ€è¦ä½¿ç”¨ conda å®‰è£…

**æ­¥éª¤**:
```bash
# 1. å¸è½½å½“å‰ç‰ˆæœ¬
docker exec starpainting-digital-human-service-1 bash -c "source /opt/conda/etc/profile.d/conda.sh && conda activate human && pip uninstall -y torch torchvision torchaudio"

# 2. å°è¯•ä» PyTorch å®˜æ–¹æºå®‰è£…
docker exec starpainting-digital-human-service-1 bash -c "source /opt/conda/etc/profile.d/conda.sh && conda activate human && pip install torch==1.11.0 torchvision==0.12.0 torchaudio==0.11.0 --extra-index-url https://download.pytorch.org/whl/cu113"

# 3. å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨ conda å®‰è£…
docker exec starpainting-digital-human-service-1 bash -c "source /opt/conda/etc/profile.d/conda.sh && conda activate human && conda install -y pytorch==1.11.0 torchvision==0.12.0 torchaudio==0.11.0 cudatoolkit=11.3 -c pytorch -c conda-forge"
```

### æ–¹æ¡ˆ2: ä½¿ç”¨ conda ç¯å¢ƒï¼ˆæ›´å¯é ï¼‰

**ä¼˜ç‚¹**:
- conda é€šå¸¸æœ‰æ›´å¥½çš„æ—§ç‰ˆæœ¬æ”¯æŒ
- å¯ä»¥ç®¡ç† CUDA å·¥å…·åŒ…ç‰ˆæœ¬
- å‡å°‘ä¾èµ–å†²çª

**æ­¥éª¤**:
```bash
# åˆ›å»ºæ–°çš„ conda ç¯å¢ƒ
docker exec starpainting-digital-human-service-1 bash -c "source /opt/conda/etc/profile.d/conda.sh && conda create -n human_fixed python=3.8 -y"

# æ¿€æ´»ç¯å¢ƒå¹¶å®‰è£… PyTorch
docker exec starpainting-digital-human-service-1 bash -c "source /opt/conda/etc/profile.d/conda.sh && conda activate human_fixed && conda install -y pytorch==1.11.0 torchvision==0.12.0 torchaudio==0.11.0 cudatoolkit=11.3 -c pytorch"

# å®‰è£…å…¶ä»–ä¾èµ–
docker exec starpainting-digital-human-service-1 bash -c "source /opt/conda/etc/profile.d/conda.sh && conda activate human_fixed && pip install -r /app/HeyGem-Linux-Python-Hack/requirements.txt"
```

### æ–¹æ¡ˆ3: æ£€æŸ¥ SDK å…¼å®¹æ€§

**å¯èƒ½æ€§**:
- SDK å¯èƒ½å®é™…ä¸Šæ”¯æŒæ›´æ–°çš„ PyTorch ç‰ˆæœ¬
- æ£€æŸ¥ SDK æ–‡æ¡£æˆ–ä»£ç ï¼Œç¡®è®¤æ˜¯å¦çœŸçš„éœ€è¦ PyTorch 1.11.0
- å¯èƒ½éœ€è¦æ›´æ–° SDK ä»£ç ä»¥æ”¯æŒæ–°ç‰ˆæœ¬

## ğŸ“‹ ä¿®å¤æ£€æŸ¥æ¸…å•

- [ ] 1. å¤‡ä»½å½“å‰ç¯å¢ƒ
- [ ] 2. å¸è½½ä¸åŒ¹é…çš„åŒ…
- [ ] 3. å®‰è£…æ­£ç¡®ç‰ˆæœ¬çš„ PyTorch
- [ ] 4. å®‰è£…æ­£ç¡®ç‰ˆæœ¬çš„ ONNX Runtime GPU
- [ ] 5. éªŒè¯ GPU å¯ç”¨æ€§
- [ ] 6. æµ‹è¯•æ¨¡å‹åŠ è½½
- [ ] 7. é‡å¯æœåŠ¡
- [ ] 8. æµ‹è¯•è§†é¢‘ç”ŸæˆåŠŸèƒ½

## ğŸš¨ é£é™©æç¤º

1. **é™çº§é£é™©**: é™çº§ PyTorch å¯èƒ½ä¼šå½±å“å…¶ä»–ä¾èµ–
2. **CUDA ç‰ˆæœ¬**: éœ€è¦ç¡®ä¿ CUDA ç‰ˆæœ¬å…¼å®¹
3. **æœåŠ¡ä¸­æ–­**: ä¿®å¤è¿‡ç¨‹éœ€è¦é‡å¯æœåŠ¡
4. **æ•°æ®ä¸¢å¤±**: ç¡®ä¿é‡è¦æ•°æ®å·²å¤‡ä»½

## ğŸ“… æŠ¥å‘Šæ—¥æœŸ

2025-11-09

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `fix_environment.sh` - è‡ªåŠ¨ä¿®å¤è„šæœ¬
- `ç¯å¢ƒä¿®å¤è¯´æ˜.md` - è¯¦ç»†ä¿®å¤è¯´æ˜
- `requirements_target.txt` - ç›®æ ‡ç‰ˆæœ¬åˆ—è¡¨
- `check_environment.py` - ç¯å¢ƒæ£€æŸ¥è„šæœ¬

