# æ•°å­—äººæœåŠ¡é‡å¯æ‰§è¡Œæ€»ç»“

## ğŸ“‹ æ‰§è¡Œæ—¶é—´

2025-01-27

## âœ… å·²æ‰§è¡Œçš„æ­¥éª¤

### 1. é‡å¯Dockerå®¹å™¨
```bash
docker restart starpainting-digital-human-service-1
```
- **çŠ¶æ€**: âœ… å·²æ‰§è¡Œ
- **è¯´æ˜**: é‡å¯å®¹å™¨ä¼šåŒæ—¶é‡å¯FastAPIæœåŠ¡

### 2. ç­‰å¾…å®¹å™¨å¯åŠ¨
- **ç­‰å¾…æ—¶é—´**: 10ç§’
- **çŠ¶æ€**: âœ… å·²ç­‰å¾…

### 3. ç­‰å¾…FastAPIæœåŠ¡åˆå§‹åŒ–
- **ç­‰å¾…æ—¶é—´**: 35ç§’ï¼ˆåŒ…å«æ¨¡å‹åŠ è½½æ—¶é—´ï¼‰
- **çŠ¶æ€**: âœ… å·²ç­‰å¾…
- **è¯´æ˜**: æ ¹æ®æ–°çš„sleepæ—¶é—´è®¾ç½®ï¼Œæ¨¡å‹åˆå§‹åŒ–éœ€è¦30ç§’

### 4. åœæ­¢æ—§çš„GradioæœåŠ¡
```bash
docker exec starpainting-digital-human-service-1 pkill -f "python app.py"
```
- **çŠ¶æ€**: âœ… å·²æ‰§è¡Œ

### 5. å¯åŠ¨GradioæœåŠ¡
```bash
docker exec -d starpainting-digital-human-service-1 bash -c "source /opt/conda/etc/profile.d/conda.sh && conda activate human && cd /app/HeyGem-Linux-Python-Hack && export PYTHONPATH=/app/HeyGem-Linux-Python-Hack && export LD_LIBRARY_PATH=/opt/conda/envs/human/lib:\$LD_LIBRARY_PATH && nohup python app.py > /tmp/gradio.log 2>&1 &"
```
- **çŠ¶æ€**: âœ… å·²æ‰§è¡Œ
- **è¯´æ˜**: GradioæœåŠ¡å·²åœ¨åå°å¯åŠ¨ï¼Œä½¿ç”¨æ–°çš„BASE_PATHé…ç½®

### 6. ç­‰å¾…GradioæœåŠ¡åˆå§‹åŒ–
- **ç­‰å¾…æ—¶é—´**: 17ç§’
- **çŠ¶æ€**: âœ… å·²ç­‰å¾…
- **è¯´æ˜**: æ ¹æ®æ–°çš„sleepæ—¶é—´è®¾ç½®ï¼ŒGradioåˆå§‹åŒ–éœ€è¦çº¦15ç§’

## ğŸ” æœåŠ¡éªŒè¯

### éªŒè¯FastAPIæœåŠ¡

```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:8308/health

# é¢„æœŸè¾“å‡º
# {"status":"ok","service":"digital-human-service"}
```

### éªŒè¯GradioæœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:7860

# æ£€æŸ¥è¿›ç¨‹
docker exec starpainting-digital-human-service-1 ps aux | grep "python app.py" | grep -v grep
```

### éªŒè¯BASE_PATHé…ç½®

```bash
# æŸ¥çœ‹FastAPIæœåŠ¡çš„BASE_PATHæ—¥å¿—
docker logs starpainting-digital-human-service-1 | grep "BASE_PATH" | tail -2

# æŸ¥çœ‹GradioæœåŠ¡çš„BASE_PATHæ—¥å¿—
docker exec starpainting-digital-human-service-1 tail -30 /tmp/gradio.log | grep "BASE_PATH"
```

### å®Œæ•´æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep starpainting-digital-human-service

# æ£€æŸ¥FastAPIæœåŠ¡
curl -s http://localhost:8308/health && echo " - FastAPIæ­£å¸¸"

# æ£€æŸ¥GradioæœåŠ¡
curl -s -o /dev/null -w "HTTP %{http_code}" http://localhost:7860 && echo " - Gradioæ­£å¸¸"

# æ£€æŸ¥è¿›ç¨‹
docker exec starpainting-digital-human-service-1 ps aux | grep -E "uvicorn|app.py" | grep -v grep
```

## ğŸ“Š æœåŠ¡è®¿é—®åœ°å€

- **FastAPIæœåŠ¡**: http://localhost:8308
  - å¥åº·æ£€æŸ¥: http://localhost:8308/health
  - APIæ–‡æ¡£: http://localhost:8308/docs

- **GradioæœåŠ¡**: http://localhost:7860
  - Webç•Œé¢: http://localhost:7860

## ğŸ“ æ—¥å¿—æŸ¥çœ‹

### FastAPIæœåŠ¡æ—¥å¿—
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker logs -f starpainting-digital-human-service-1

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
docker logs --tail 50 starpainting-digital-human-service-1
```

### GradioæœåŠ¡æ—¥å¿—
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker exec starpainting-digital-human-service-1 tail -f /tmp/gradio.log

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
docker exec starpainting-digital-human-service-1 tail -50 /tmp/gradio.log
```

### BASE_PATHé…ç½®æ—¥å¿—
```bash
# FastAPIæœåŠ¡çš„BASE_PATHæ—¥å¿—
docker logs starpainting-digital-human-service-1 | grep "BASE_PATH"

# GradioæœåŠ¡çš„BASE_PATHæ—¥å¿—
docker exec starpainting-digital-human-service-1 tail -50 /tmp/gradio.log | grep "BASE_PATH"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åˆå§‹åŒ–æ—¶é—´**: 
   - FastAPIæœåŠ¡éœ€è¦çº¦30ç§’åˆå§‹åŒ–ï¼ˆæ¨¡å‹åŠ è½½ï¼‰
   - GradioæœåŠ¡éœ€è¦çº¦15ç§’åˆå§‹åŒ–ï¼ˆæœåŠ¡å¯åŠ¨ï¼‰

2. **BASE_PATHé…ç½®**:
   - ä¸¤ä¸ªæœåŠ¡ç°åœ¨éƒ½ä½¿ç”¨ç›¸åŒçš„BASE_PATHé…ç½®
   - æœåŠ¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶åˆ›å»ºç›®å½•
   - ç»“æœæ–‡ä»¶å°†ç»Ÿä¸€å­˜å‚¨åœ¨ `/data2/home_back/gujiaxin/work/batchshort1/assrt/human/result/` ç›®å½•

3. **ç«¯å£**:
   - FastAPIæœåŠ¡: 8308
   - GradioæœåŠ¡: 7860

## ğŸ”§ å¦‚æœæœåŠ¡æœªæ­£å¸¸å¯åŠ¨

### æ£€æŸ¥å®¹å™¨çŠ¶æ€
```bash
docker ps -a | grep starpainting-digital-human-service
```

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—
```bash
docker logs starpainting-digital-human-service-1
```

### æ‰‹åŠ¨å¯åŠ¨GradioæœåŠ¡
```bash
docker exec -it starpainting-digital-human-service-1 bash
source /opt/conda/etc/profile.d/conda.sh
conda activate human
export PYTHONPATH=/app/HeyGem-Linux-Python-Hack
export LD_LIBRARY_PATH=/opt/conda/envs/human/lib:$LD_LIBRARY_PATH
cd /app/HeyGem-Linux-Python-Hack
python app.py
```

## ğŸ“… æ›´æ–°å†…å®¹

æœ¬æ¬¡é‡å¯åŒ…å«äº†ä»¥ä¸‹æ›´æ–°ï¼š
1. âœ… å¢åŠ äº†sleepæ—¶é—´ï¼ˆæé«˜ç¨³å®šæ€§ï¼‰
2. âœ… æ·»åŠ äº†BASE_PATHé…ç½®åˆ°app.py
3. âœ… ç»Ÿä¸€äº†ç»“æœæ–‡ä»¶å­˜å‚¨è·¯å¾„

## ğŸ“… æ–‡æ¡£æ—¥æœŸ

2025-01-27

