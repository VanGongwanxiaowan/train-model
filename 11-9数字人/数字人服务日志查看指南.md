# 数字人服务日志查看指南

## 📋 日志文件位置

### 1. FastAPI服务日志
- **位置**: Docker容器标准输出
- **查看方式**: `docker logs` 命令

### 2. Gradio服务日志
- **位置**: `/tmp/gradio.log`（容器内）
- **查看方式**: `docker exec` 命令

### 3. 服务业务日志
- **位置**: `/app/HeyGem-Linux-Python-Hack/log/dh.log`（容器内）
- **查看方式**: `docker exec` 命令

## 🔍 查看日志的方法

### 方法1: 实时查看Gradio日志（推荐）

```bash
# 实时跟踪日志（类似于 tail -f）
docker exec starpainting-digital-human-service-1 tail -f /tmp/gradio.log
```

**说明**:
- `tail -f`: 实时跟踪文件末尾的新内容
- 按 `Ctrl+C` 退出

### 方法2: 查看Gradio日志的最后N行

```bash
# 查看最后50行
docker exec starpainting-digital-human-service-1 tail -50 /tmp/gradio.log

# 查看最后100行
docker exec starpainting-digital-human-service-1 tail -100 /tmp/gradio.log

# 查看最后20行
docker exec starpainting-digital-human-service-1 tail -20 /tmp/gradio.log
```

### 方法3: 查看Gradio日志并过滤

```bash
# 查看包含"BASE_PATH"的日志
docker exec starpainting-digital-human-service-1 tail -100 /tmp/gradio.log | grep "BASE_PATH"

# 查看包含"ERROR"的日志
docker exec starpainting-digital-human-service-1 tail -100 /tmp/gradio.log | grep "ERROR"

# 查看包含"初始化"的日志
docker exec starpainting-digital-human-service-1 tail -100 /tmp/gradio.log | grep "初始化"

# 查看包含"任务"的日志
docker exec starpainting-digital-human-service-1 tail -100 /tmp/gradio.log | grep "任务"
```

### 方法4: 查看FastAPI服务日志

```bash
# 实时查看FastAPI日志
docker logs -f starpainting-digital-human-service-1

# 查看最后50行
docker logs --tail 50 starpainting-digital-human-service-1

# 查看最后100行
docker logs --tail 100 starpainting-digital-human-service-1

# 查看包含"BASE_PATH"的日志
docker logs starpainting-digital-human-service-1 | grep "BASE_PATH"

# 查看包含"ERROR"的日志
docker logs starpainting-digital-human-service-1 | grep "ERROR"
```

### 方法5: 查看业务日志（dh.log）

```bash
# 实时查看业务日志
docker exec starpainting-digital-human-service-1 tail -f /app/HeyGem-Linux-Python-Hack/log/dh.log

# 查看最后50行
docker exec starpainting-digital-human-service-1 tail -50 /app/HeyGem-Linux-Python-Hack/log/dh.log

# 查看最后100行
docker exec starpainting-digital-human-service-1 tail -100 /app/HeyGem-Linux-Python-Hack/log/dh.log

# 查看包含特定任务ID的日志
docker exec starpainting-digital-human-service-1 tail -100 /app/HeyGem-Linux-Python-Hack/log/dh.log | grep "1004"

# 查看错误日志
docker exec starpainting-digital-human-service-1 tail -100 /app/HeyGem-Linux-Python-Hack/log/dh.log | grep "ERROR"
```

## 📊 常用日志查看场景

### 场景1: 查看服务启动日志

```bash
# 查看Gradio服务启动日志
docker exec starpainting-digital-human-service-1 tail -50 /tmp/gradio.log | head -30

# 查看FastAPI服务启动日志
docker logs --tail 50 starpainting-digital-human-service-1 | head -30
```

### 场景2: 查看BASE_PATH配置日志

```bash
# Gradio服务的BASE_PATH日志
docker exec starpainting-digital-human-service-1 tail -100 /tmp/gradio.log | grep "BASE_PATH"

# FastAPI服务的BASE_PATH日志
docker logs starpainting-digital-human-service-1 | grep "BASE_PATH"
```

### 场景3: 查看错误日志

```bash
# Gradio服务错误
docker exec starpainting-digital-human-service-1 tail -200 /tmp/gradio.log | grep -i "error"

# FastAPI服务错误
docker logs starpainting-digital-human-service-1 | grep -i "error"

# 业务日志错误
docker exec starpainting-digital-human-service-1 tail -200 /app/HeyGem-Linux-Python-Hack/log/dh.log | grep -i "error"
```

### 场景4: 查看特定任务的日志

```bash
# 查看任务ID为"1004"的日志
docker exec starpainting-digital-human-service-1 tail -200 /app/HeyGem-Linux-Python-Hack/log/dh.log | grep "1004"

# 查看最近的任务日志
docker exec starpainting-digital-human-service-1 tail -100 /app/HeyGem-Linux-Python-Hack/log/dh.log | grep "任务"
```

### 场景5: 同时查看多个日志

```bash
# 在一个终端中同时查看多个日志（需要多个终端窗口）
# 终端1: Gradio日志
docker exec starpainting-digital-human-service-1 tail -f /tmp/gradio.log

# 终端2: FastAPI日志
docker logs -f starpainting-digital-human-service-1

# 终端3: 业务日志
docker exec starpainting-digital-human-service-1 tail -f /app/HeyGem-Linux-Python-Hack/log/dh.log
```

## 🛠️ 高级日志查看技巧

### 技巧1: 使用less查看大日志文件

```bash
# 使用less查看日志（可以上下滚动）
docker exec starpainting-digital-human-service-1 less /tmp/gradio.log

# 在less中：
# - 按空格键向下翻页
# - 按b键向上翻页
# - 按q键退出
# - 按/键搜索（例如：/ERROR）
```

### 技巧2: 搜索日志内容

```bash
# 搜索包含"初始化"的日志行
docker exec starpainting-digital-human-service-1 grep "初始化" /tmp/gradio.log

# 搜索包含"ERROR"的日志行（忽略大小写）
docker exec starpainting-digital-human-service-1 grep -i "error" /tmp/gradio.log

# 搜索包含"BASE_PATH"的日志行，并显示行号
docker exec starpainting-digital-human-service-1 grep -n "BASE_PATH" /tmp/gradio.log
```

### 技巧3: 查看日志文件大小

```bash
# 查看日志文件大小
docker exec starpainting-digital-human-service-1 ls -lh /tmp/gradio.log
docker exec starpainting-digital-human-service-1 ls -lh /app/HeyGem-Linux-Python-Hack/log/dh.log
```

### 技巧4: 清空日志文件（谨慎使用）

```bash
# 清空Gradio日志（谨慎使用）
docker exec starpainting-digital-human-service-1 bash -c "> /tmp/gradio.log"

# 清空业务日志（谨慎使用）
docker exec starpainting-digital-human-service-1 bash -c "> /app/HeyGem-Linux-Python-Hack/log/dh.log"
```

### 技巧5: 导出日志到本地

```bash
# 导出Gradio日志到本地
docker exec starpainting-digital-human-service-1 cat /tmp/gradio.log > gradio.log

# 导出业务日志到本地
docker exec starpainting-digital-human-service-1 cat /app/HeyGem-Linux-Python-Hack/log/dh.log > dh.log

# 导出FastAPI日志到本地
docker logs starpainting-digital-human-service-1 > fastapi.log
```

## 📝 日志查看快捷键

### 在tail -f模式下
- `Ctrl+C`: 退出实时查看
- 无其他快捷键（只是实时显示）

### 在less模式下
- `空格键`: 向下翻页
- `b键`: 向上翻页
- `q键`: 退出
- `/关键词`: 搜索（按n查找下一个，按N查找上一个）
- `g键`: 跳到文件开头
- `G键`: 跳到文件末尾

## 🔍 日志查看示例

### 示例1: 查看Gradio服务启动过程

```bash
# 查看启动日志
docker exec starpainting-digital-human-service-1 tail -50 /tmp/gradio.log | grep -E "初始化|启动|BASE_PATH|Gradio"
```

### 示例2: 查看最近的错误

```bash
# 查看最近的错误（最后200行中的错误）
docker exec starpainting-digital-human-service-1 tail -200 /tmp/gradio.log | grep -i "error" | tail -10
```

### 示例3: 查看服务状态

```bash
# 查看服务是否正常启动
docker exec starpainting-digital-human-service-1 tail -30 /tmp/gradio.log | grep -E "启动|运行|正常"
```

## ⚠️ 注意事项

1. **实时查看会阻塞终端**: 使用 `tail -f` 或 `docker logs -f` 时，终端会被阻塞，按 `Ctrl+C` 退出

2. **日志文件可能很大**: 如果日志文件很大，使用 `tail -N` 查看最后N行，而不是查看整个文件

3. **日志轮转**: 如果日志文件过大，可能需要清理或轮转日志

4. **权限问题**: 确保有权限访问容器和日志文件

## 📅 更新日期

2025-01-27

