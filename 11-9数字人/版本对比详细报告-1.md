# 版本对比详细报告

## 执行时间
2025-11-09

## 检查结果

### ✅ 版本正确的包（3个）
- cv2box: 0.5.9 ✅
- apstone: 0.0.8 ✅
- typeguard: 2.13.3 ✅
- numexpr: 2.8.6 ✅

### ⚠️ 版本过高的包（35个）

#### 关键包（影响最大）

1. **torch**: 2.4.1 → 1.11.0+cu113 (需要降级)
2. **torchaudio**: 2.4.1 → 0.11.0+cu113 (需要降级)
3. **torchvision**: 0.19.1 → 0.12.0+cu113 (需要降级)
4. **numpy**: 1.24.4 → 1.21.6 (需要降级)
5. **onnxruntime-gpu**: 1.18.0 → 1.9.0 (需要降级)
6. **opencv-python**: 4.11.0.86 → 4.7.0.72 (需要降级)
7. **librosa**: 0.11.0 → 0.8.1 (需要降级)
8. **scipy**: 1.10.1 → 1.7.1 (需要降级)

#### 其他包（也需要降级）

9. **matplotlib**: 3.7.5 → 3.5.3
10. **pillow**: 10.4.0 → 9.1.1
11. **protobuf**: 5.29.4 → 4.21.5
12. **scikit-learn**: 1.3.2 → 1.0.2
13. **scikit-image**: 0.21.0 → 0.19.3
14. **numba**: 0.58.1 → 0.55.2
15. **networkx**: 3.1 → 2.6.3
16. **kiwisolver**: 1.4.7 → 1.4.4
17. **joblib**: 1.4.2 → 1.1.0
18. **imageio**: 2.35.1 → 2.19.3
19. **cycler**: 0.12.1 → 0.11.0
20. **decorator**: 5.2.1 → 5.1.1
21. **filelock**: 3.16.1 → 3.7.1
22. **flatbuffers**: 25.2.10 → 2.0
23. **fonttools**: 4.56.0 → 4.36.0
24. **huggingface-hub**: 0.29.3 → 0.0.8
25. **idna**: 3.10 → 3.3
26. **audioread**: 3.0.1 → 2.1.9
27. **cffi**: 1.17.1 → 1.15.0
28. **charset-normalizer**: 3.4.1 → 2.0.12
29. **click**: 8.1.8 → 8.1.3
30. **packaging**: 24.2 → 21.3
31. **pooch**: 1.8.2 → 1.6.0
32. **pycparser**: 2.22 → 2.21
33. **pyparsing**: 3.1.4 → 3.0.9
34. **python-dateutil**: 2.9.0.post0 → 2.8.2
35. **requests**: 2.32.3 → 2.27.1
36. **soundfile**: 0.13.1 → 0.10.3.post1
37. **threadpoolctl**: 3.5.0 → 3.1.0
38. **tifffile**: 2023.7.10 → 2021.11.2
39. **tqdm**: 4.67.1 → 4.64.0
40. **urllib3**: 2.2.3 → 1.26.9
41. **zipp**: 3.20.2 → 3.8.0

## 问题分析

### 主要问题

1. **PyTorch 版本差异巨大**
   - 当前: 2.4.1 (最新版)
   - 目标: 1.11.0+cu113 (旧版本)
   - 影响: PyTorch 2.x 与 1.x 有重大变化，可能导致兼容性问题

2. **NumPy 版本过高**
   - 当前: 1.24.4
   - 目标: 1.21.6
   - 影响: NumPy 1.24+ 可能与旧版本的 PyTorch 不兼容

3. **ONNX Runtime 版本过高**
   - 当前: 1.18.0
   - 目标: 1.9.0
   - 影响: 可能与队列阻塞问题相关

4. **OpenCV 版本过高**
   - 当前: 4.11.0.86
   - 目标: 4.7.0.72
   - 影响: 新版本可能有 API 变化

5. **Librosa 版本过高**
   - 当前: 0.11.0
   - 目标: 0.8.1
   - 影响: 音频处理库，版本差异可能影响功能

### 影响

版本过高可能导致：
1. **兼容性问题**：新版本与旧代码不兼容
2. **队列阻塞**：ONNX Runtime 版本过高可能导致队列阻塞
3. **性能问题**：新版本可能有性能变化
4. **稳定性问题**：新版本可能引入新的 bug

## 解决方案

### 方案 1: 使用降级脚本（推荐）

已创建降级脚本：`降级到目标版本.sh`

执行步骤：
1. 备份当前环境
2. 卸载关键包
3. 安装目标版本
4. 验证安装

### 方案 2: 手动降级

按照 requirements.txt 逐个安装：
```bash
pip install -r requirements.txt
```

### 方案 3: 重新创建环境

如果降级后仍有问题，可以考虑重新创建 conda 环境。

## 注意事项

1. **PyTorch 安装**：需要使用 CUDA 11.3 版本，可能需要从 PyTorch 官网或镜像源安装
2. **依赖关系**：某些包的降级可能影响其他包的安装
3. **测试**：降级后需要测试功能是否正常
4. **备份**：降级前请备份当前环境

## 下一步

1. **执行降级脚本**：运行 `降级到目标版本.sh`
2. **验证安装**：检查关键包版本是否正确
3. **测试功能**：测试数字人生成功能是否正常
4. **重启服务**：应用新环境

